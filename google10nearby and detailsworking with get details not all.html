<!DOCTYPE html>
<html>
  <head>
    <title>Place details</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 80%;
      }
    </style>
<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=PT+Sans:400,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,700' rel='stylesheet' type='text/css'>
</head>

   <script>
  
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      center: {
        lat: 40.5745,
        lng: -74.6368
      }, //input by geolocator
      zoom: 15
    }); //END var map = new google.map 
    var infowindow = new google.maps.InfoWindow();
    var service = new google.maps.places.PlacesService(map);
    var test2 = [];
    var infowindow;
    var placeId;
    var placeIdArray = [];
    //var catArray = ["amusement_park","aquarium","art_gallery","bowling_alley","campground","museum","park","zoo"];
    var catArray = ["museum","park","zoo"];

    searchNby();


    function searchNby() { //request   send send send 
      for (var i = 0; i < catArray.length; i++) {
        service.nearbySearch({
          location: {
            lat: 40.5745,
            lng: -74.6368
          },
          radius: 25000,
          type: catArray[i],
        }, callbackNby);
        console.log("fctn searchNby" + " " + catArray[i]);
      } // for (var i = 0; i < catArray.length; i++ )
    };

    function callbackNby(results, status) {
        for (var j = 0; j < results.length; j++){
        if (status === google.maps.places.PlacesServiceStatus.OK) {
            console.log("fctn callbackNby" + " " +results.length)
            placeId = results[j].place_id;
            name = results[j].name;
            placeIdArray.push(placeId);
            console.log("fctn callbackNby" + " " +results[j].name + placeId);
            detailrqst(placeId);
          }//END   if (status === google.maps.places.PlacesServiceStatus.OK)
        }; //END  for (var j = 0; j < results.length; j++)
        }; //END  function callbackNby(results, status) {

      function detailrqst(){
             console.log("fctn detail request" + "" + placeId);
            service.getDetails({
              placeId: placeId 
            }, function(results, status) {
              if (status === google.maps.places.PlacesServiceStatus.OK) {
                rNAme = results.name;
                rWebsite = results.website;
                rfrmtphone = results.formatted_phone_number;
                radd = results.formatted_address;

          var eventDiv = $('<div>');
          eventDiv.addClass('card');
          var eventIntro = $('<p>');
          eventIntro.addClass('card-block');
          var introTitle = $('<h4>');
          introTitle.addClass('card-title');
          introTitle.text(rNAme);
          //var startTime = rWebsite;
          var introText = $('<p>');
          introText.addClass('card-text');
          introText.text(rWebsite + rfrmtphone);
          
          //introText.text(moment(startTime).format('dddd MMMM Do, hh:mm a'));
          //var eventImg = $('<img>');
          //eventImg.addClass('card-img-top');
          //eventImg.attr('src', result[i].logo.url)
          eventIntro.append(introTitle);
          eventIntro.append(introText);
          //eventDiv.append(eventImg);
          eventDiv.append(eventIntro);
          $('#events').append(eventDiv);


                test2.push({
                  rNAme: rNAme,
                  rWebsite: rWebsite,
                  rfrmtphone: rfrmtphone,
                  radd: radd
                }); //END test2.push 
              }  //END if (status === ok
                console.log(test2.rNAme);
                //console.log("getDetails" + "" + place_id + placeIdArray.length);
                
            });  //END function(results, status) 
        } //END  function detailsrqst()
   
  } //END  function initMap()
  </script>
   
  </head>
  <body>
    <div id="map"></div>
    <div id="events"></div>

    <script async defer
    src="https://crossorigin.me/https://maps.googleapis.com/maps/api/js?key=AIzaSyD3P2HaBwFZ6zK1miYLG3GuUWFv2RjGyfo&libraries=places&callback=initMap">
    </script>

  </body>
</html>